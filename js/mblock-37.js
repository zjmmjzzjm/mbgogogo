(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{835:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=g(a(28)),l=g(a(22)),s=g(a(80)),u=g(a(77)),o=g(a(73)),i=g(a(27)),r=g(a(3)),d=g(a(9)),c=g(a(2)),f=g(a(7)),m=g(a(5)),p=g(a(6)),h=g(a(1)),E=a(14),C=g(a(87)),T=g(a(72)),v=a(18),b=g(a(16));function g(e){return e&&e.__esModule?e:{default:e}}var N=function(e){function t(e){(0,c.default)(this,t);var a=(0,m.default)(this,(t.__proto__||(0,d.default)(t)).call(this,e));return a.handleBack=function(){var e=a.props.account.isLogin;b.default.replace((0,v.parseRoute)(e?"/update":"/login/loginPwd"))},a.handleCancel=function(){b.default.replace((0,v.parseRoute)("/"))},a.handleSend=function(){var e=a.props,t=e.send,n=e.account,l=void 0===n?{}:n;a.setState({canResend:!1,getCodeBtnText:""});var s=l.emailNum?l.emailNum:l.data&&l.data.email||"";s||b.default.replace((0,v.parseRoute)("/")),t(s,function(){a.setCodeBtnText()},function(e){99999!==e.code?v.showErrorMessage.call(a,"FORM.BUTTON.CODE.SEND.FAIL.MSG",e.code):v.showErrorMessage.bind(a)("MSG.99999")})},a.handleSubmit=function(e){e.preventDefault(),a.props.form.validateFields(function(e,t){if(!e){var n=a.props.account.emailNum?a.props.account.emailNum:a.props.account.data.email;a.props.saveValidCode((0,r.default)({email:n},t),a.submitSuccessCb.bind(a),a.submitFailCb.bind(a))}})},a.renderTitle=function(){var e=a.props.intlr;return h.default.createElement("div",{className:"pwd-title title-tac"},h.default.createElement("button",{"aria-label":"Back",className:"ant-btn-back",onClick:a.handleBack},h.default.createElement(i.default,{type:"left"})),e.messages["USER.FORGET.PASSWORD"])},a.state={canResend:!1,getCodeBtnText:""},a.focusEl=null,a.focusTimer=null,a}return(0,p.default)(t,e),(0,f.default)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.account,a=void 0===t?{}:t;a.emailNum||a.isLogin?(this.handleSend(),this.focusTimer=setTimeout(function(){e.focusEl&&e.focusEl.focus()})):b.default.push((0,v.parseRoute)("/"))}},{key:"componentWillUnmount",value:function(){clearTimeout(this.cutdownTimer),clearTimeout(this.focusTimer),this.focusTimer=null}},{key:"hasDisableBtn",value:function(){var e,t=this.props.form,a=t.getFieldsError;return!(0,t.isFieldTouched)("validCode")||(e=a(),(0,o.default)(e).some(function(t){return e[t]}))}},{key:"setCodeBtnText",value:function(){var e=this,t=60;!function a(){e.cutdownTimer=setTimeout(function(){var n=e.props.intlr.messages["FORM.BUTTON.CODE.SENDED"].format(t);e.setState({getCodeBtnText:n}),--t>=0?a():e.setState({canResend:!0,getCodeBtnText:e.props.intlr.messages["NO.CODE"]})},1e3)}()}},{key:"submitSuccessCb",value:function(){b.default.replace((0,v.parseRoute)("/forget/setPwd"))}},{key:"submitFailCb",value:function(e){if(99999!==e.code){var t=this.props,a=t.intlr;t.form.setFields({validCode:{errors:[new Error(a.messages["FORM.FIELD.CODE.CURRENT.MSG"])]}})}else v.showErrorMessage.bind(this)("MSG.99999")}},{key:"render",value:function(){var e=this,t=this.props,a=t.form,o=t.intlr,i=t.account,r=this.state,d=r.canResend,c=r.getCodeBtnText,f=a.getFieldDecorator,m=i.emailNum?i.emailNum:i.data?i.data.email:"";return h.default.createElement(n.default,{visible:!0,title:this.renderTitle(),width:"100%",className:"small-modal",closable:!1,maskClosable:!1,keyboard:!1,onCancel:this.handleCancel,footer:null},h.default.createElement(s.default,{onSubmit:this.handleSubmit},h.default.createElement("p",{className:"emailNum-section"},o.messages["FORM.BUTTON.CODE.SEND.SUCCESS.MSG"],m),h.default.createElement(s.default.Item,null,f("validCode",{rules:[{required:!0,message:o.messages["FORM.FIELD.CODE.MSG"]}]})(h.default.createElement(u.default,{ref:function(t){return e.focusEl=t},type:"text",autoComplete:"off",placeholder:o.messages["FORM.FIELD.CODE.PH"]}))),h.default.createElement(s.default.Item,null,h.default.createElement(l.default,{type:"primary",htmlType:"submit",className:"login-form-button",style:{width:"100%"},loading:i.checkCodeRequest===C.default.PENDING,disabled:this.hasDisableBtn()},o.messages["BUTTON.NEXT.TEXT"])),h.default.createElement("p",{className:"user-links",style:{textAlign:"center"}},c,d&&h.default.createElement("a",{onClick:this.handleSend},o.messages["FORM.BUTTON.CODE.SEND.AGAIN"]))))}}]),t}(h.default.Component);t.default=(0,E.connect)(function(e){return{intlr:e.intlr,account:e.account}},function(e){return{send:function(t,a,n){e(T.default.getValidCode(t,a,n))},saveValidCode:function(t,a,n){e(T.default.saveValidCode(t,a,n))}}})(s.default.create()(N))}}]);